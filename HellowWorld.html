<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>
    <style>
      @import url("./Cesium/Widgets/widgets.css");
      * {
        margin: 0;
        padding: 0;
      }
      html,
      body {
        width: 100%;
        height: 100%;
      }
    </style>
  </head>
  <body>
    <div id="cesium-container"></div>
    <script src="./Cesium/Cesium.js"></script>
    <script>
            var viewer = new Cesium.Viewer("cesium-container", {
              baseLayerPicker: false,
              imageryProvider: false,
              // geocoder: false,
              // homeButton: false,
              // sceneModePicker: false,
              // baseLayerPicker: false,
              // navigationHelpButton: false,
              // animation: false,
              // creditContainer: "cesium-container",
              // timeline: false,
              // fullscreenButton: false,
              // vrButton: false,
            });
            // viewer.scene.debugShowFramesPerSecond = true; // 帧数监听
            viewer.scene.skyAtmosphere.show = false  // 是否展示大气层
            viewer.scene.globe.showGroundAtmosphere = false;

            // var yellowLine = viewer.entities.add({
            //   name: "Red line on the surface",
            //   polyline: {
            //     positions: Cesium.Cartesian3.fromDegreesArray([
            //       112.82436, 23.071506, 112.82742, 23.067512, 112.828878, 23.064659,
            //       112.830799, 23.060947, 112.832166, 24.058329,
            //     ]),
            //     width: 2,
            //     material: Cesium.Color.YELLOW,
            //   },
            // });
             viewer.scene.skyBox.show = false;
             viewer.scene.globe.baseColor = new Cesium.Color(255,0,0,1)

           let provider = {
        "wmts": "C_WebMapTileServiceImageryProvider",
        "wms": "WebMapServiceImageryProvider",
        "single": "SingleTileImageryProvider",
        "url": "UrlTemplateImageryProvider"
    }

    function setBaseLayer(param, flag, index) {
        if(flag){
            let p = {...param};
            p.provider.tilingScheme = p.provider.projection !== "WebMercator" ? new Cesium.GeographicTilingScheme() : new Cesium.WebMercatorTilingScheme();
            let imageryLayer = new Cesium.ImageryLayer(new Cesium[provider[p.type.toLowerCase()]](param.provider), param.layer);
            imageryLayer.id = param.id;
            viewer.imageryLayers.add(imageryLayer, index)
        }else{
            for(let i = 0; i < viewer.imageryLayers.length; i ++) {
                if(viewer.imageryLayers._layers[i].id === param.id) {
                    viewer.imageryLayers.remove(viewer.imageryLayers.get(i) );
                }
            }
        }
    }

    function setTerrainLayer(param, flag) {
        if(flag){
            viewer.terrainProvider = new Cesium.CesiumTerrainProvider({
                url: param.url
            });
        }else{
            viewer.terrainProvider= new Cesium.EllipsoidTerrainProvider();
        }
    }

    Cesium["C_layerManager"] = {
        setBaseLayer,
        setTerrainLayer
    }

    fetch('./贴其他的图/config.json').then(res=>res.json()).then(res=>{
      console.log(res.mapService)
      const imageryLayers = res.mapService.imageryLayers;
      if (imageryLayers && Array.isArray(imageryLayers)) {
          imageryLayers.forEach((item, i) => {
              if (item.preloading && i === 0) {
                  Cesium.C_layerManager.setBaseLayer(item, true);
              }
          });
      }
      // const dem = window.$config.mapService.dem;
      // if (dem && Array.isArray(dem)) {
      //     dem.forEach((item) => {
      //         if (item.preloading) {
      //             Cesium.C_layerManager.setTerrainLayer(item, true);
      //         }
      //     });
      // }
    })


    </script>
  </body>
</html>
